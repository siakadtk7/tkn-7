{% extends 'base.html' %}

{% block title %}Dashboard Guru{% endblock %}

{% block content %}

<!-- ================= Wrapper Utama ================= -->
<div style="background-color: white; padding: 2rem; border-radius: 1rem;
            box-shadow: 0 8px 50px rgba(0,0,0,0.05); margin-top: -4rem;
            max-width: 950px; margin-left: auto; margin-right: auto; position: relative; z-index: 1;">
    <div class="row mb-5">
        <!-- Pie Chart Data Siswa -->
        <div  style="50%" class="col-md-4 mb-4">
            <canvas id="siswaChart"
                    data-laki-laki="{{ siswa_laki_laki }}"
                    data-perempuan="{{ siswa_perempuan }}"></canvas>
        </div>

        <!-- Line Chart Kehadiran Harian -->
        <div style="width: 60%;" class="col-md-8 mb-4">
            <canvas id="dailyAttendanceChart"
                    data-dates="{{ attendance_dates }}"
                    data-counts="{{ attendance_hadir_counts }}"></canvas>
        </div>
    </div>

</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {

    // ===== Pie Chart Data Siswa =====
    const siswaCanvas = document.getElementById('siswaChart');
    const siswaChart = new Chart(siswaCanvas.getContext('2d'), {
        type: 'pie',
        data: {
            labels: ['Laki-laki', 'Perempuan'],
            datasets: [{
                data: [
                    Number(siswaCanvas.dataset.lakiLaki),
                    Number(siswaCanvas.dataset.perempuan)
                ],
                backgroundColor: ['#2196f3', '#e91e63'],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            plugins: { legend: { position: 'bottom' }, title: { display: true, text: 'Jumlah Siswa' } }
        }
    });

    // ===== Line Chart Kehadiran Harian =====
    const dailyAttendanceCanvas = document.getElementById('dailyAttendanceChart');
    const dates = JSON.parse(dailyAttendanceCanvas.dataset.dates);
    const counts = JSON.parse(dailyAttendanceCanvas.dataset.counts);

    const dailyAttendanceChart = new Chart(dailyAttendanceCanvas.getContext('2d'), {
        type: 'line',
        data: {
            labels: dates,
            datasets: [{
                label: 'Jumlah Hadir',
                data: counts,
                borderColor: '#4CAF50',
                backgroundColor: 'rgba(76, 175, 80, 0.2)',
                fill: true,
                tension: 0.1
            }]
        },
        options: {
            responsive: true,
            plugins: { legend: { display: false }, title: { display: true, text: 'Kehadiran Harian Siswa Bulan ini' } },
            scales: {
                y: { beginAtZero: true, title: { display: true, text: 'Jumlah Siswa Hadir' } },
                x: { title: { display: true, text: 'Tanggal' } }
            }
        }
    });

});
</script>
{% endblock %}
